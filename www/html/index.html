<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
<meta name="generator" content="Jekyll v3.8.6">
<title>PiVert</title>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>

<!-- Favicons -->
<style>
.bd-placeholder-img {
    font-size: 1.125rem;
    text-anchor: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

@media (min-width: 768px) {
    .bd-placeholder-img-lg {
        font-size: 3.5rem;
    }
}
</style>

</head>
<body data-spy="scroll">

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" href="#CONTROL">
                  <span data-feather="activity"></span>
                  Contrôle 
                </a>
              </li>
            </ul>
        </div>
    </nav>

    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
	  
        <div id="CONTROL" class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Contrôle</h1>
        </div>
	<button type="button" class="btn" id="airpump" onclick="Actuator(this)">Pompe à air</button>
	<button type="button" class="btn" id="waterpump" onclick="Actuator(this)">Pompe à eau</button>
	<button type="button" class="btn" id="sink"onclick="Actuator(this)">Purge</button>

        <button type="button" class="btn" id="light" onclick="Actuator(this)">Lumière</button>
        <button type="button" class="btn" id="fan" onclick="Actuator(this)">Ventilateur</button>
        <button type="button" class="btn" id="heater"onclick="Actuator(this)">Résistance</button>

    </main>
</div>
</div>
<script type="text/javascript">
feather.replace();
var api = 'http://192.168.1.39:8000';

var sensors = ['airpump','waterpump','sink','light','heater','fan' ];
sensors.forEach(Sensor);

function getEndPoint(id) {
var actuator
    switch (id) {
        case 'airpump':
            actuator = 'relays/gpio/airpump';
            break;
        case 'waterpump':
            actuator = 'relays/gpio/waterpump';
            break;
        case 'sink':
            actuator = 'relays/i2c/sink';
            break;
        case 'light':
            actuator = 'relays/i2c/light';
            break;
        case 'heater':
            actuator = 'relays/gpio/heater';
            break;
        case 'fan':
            actuator = 'relays/i2c/fan';
            break;
        default:
            actuator = 'relays/gpio/airpump';
    }
return actuator;
}

function Actuator (ele) {
var actuator
    actuator=getEndPoint(ele.id);

    if ($('#'+ele.id).hasClass('active')) {
        toggle = 'OFF';
        $('#'+ele.id).removeClass('active');
    }
    else {
        toggle = 'ON';
        $('#'+ele.id).removeClass('btn-light').removeClass('btn-success');
    }
    $('#'+ele.id).removeClass('btn-light').removeClass('btn-success');

    $.ajax({
         url: api+"/call?call="+actuator+"&switch="+toggle,
         dataType: "text",
         type: 'GET',
         crossDomain: true,
         success: function(response) {
             console.log(ele.id+': '+response);
             if (response==1) 
		$('#'+ele.id).addClass('active').addClass('btn-success');
             else
                $('#'+ele.id).addClass('btn-light');
         }
    });
}

function Sensor (id) {
var sensor
    sensor = getEndPoint(id)
 
    $.ajax({
         url: api+"/get?state="+sensor,
         dataType: "text",
         type: 'GET',
         crossDomain: true,
         success: function(response) {
             console.log(id+': '+response);
             if (response==1)
                $('#'+id).addClass('active').addClass('btn-success');
             else
                $('#'+id).addClass('btn-light');
         }
    });
}


</script>
</body>
</html>

